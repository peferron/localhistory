{"version":3,"sources":["playbyplay.js","playbyplay.min.js"],"names":["global","factory","exports","module","define","amd","playbyplay","this","required","supportsLocalStorage","Error","supportsJSON","supportsIsArray","storage__save","run","runs","undefined","storage__load","err","support","console","error","length","sameRun","push","saveRuns","a","b","JSON","stringify","maxRuns","splice","runsStr","maxLength","removeFirstHalf","localStorage","runsKey","isQuotaError","arr","Math","ceil","code","name","parse","Array","isArray","storage__clear","removeItem","index__save","callback","promisify","storage","save","setTimeout","index__load","load","index__clear","clear","syncFn","asyncFn","arguments","now","promise","Promise","resolve","reject","exec","result","fn","e","Object","defineProperties","get","configurable","enumerable","supportsConsole","key","value","random","success","maxBytes"],"mappings":"CAAA,SAAWA,EAAQC,GACI,gBAAZC,UAA0C,mBAAXC,QAAyBF,EAAQC,SACrD,kBAAXE,SAAyBA,OAAOC,IAAMD,QAAQ,WAAYH,GACjEA,EAASD,EAAOM,gBAClBC,KAAM,SAAUL,GAAW,YA4BzB,SAASM,KACL,IAAKC,EACD,KAAM,IAAIC,OAAM,gCAGpB,KAAKC,EACD,KAAM,IAAID,OAAM,wBAGpB,KAAKE,EACD,KAAM,IAAIF,OAAM,kCA0BxB,QAASG,GAAcC,GACnB,GAAIC,GAAIC,MACR,KACID,EAAOE,IACT,MAAOC,GACDC,EAAQC,SACRA,QAAQC,MAAM,8DAA+DH,GAGjFH,KAGAA,EAAKO,QAAUC,EAAQT,EAAKC,EAAKA,EAAKO,OAAS,MAInDP,EAAKS,KAAKV,GACVW,EAASV,IAGb,QAASQ,GAAQG,EAAGC,GAChB,MAAOC,MAAKC,UAAUH,KAAOE,KAAKC,UAAUF,GAGhD,QAASF,GAASV,GAKd,IAJIA,EAAKO,OAASQ,GACdf,EAAKgB,OAAO,EAAGhB,EAAKO,OAASQ,KAGpB,CACT,GAAIE,GAAUJ,KAAKC,UAAUd,EAE7B,IAAIiB,EAAQV,OAASW,EAArB,CACI,GAAIlB,EAAKO,OAAS,EACd,KAAM,IAAIZ,OAAM,gCAAgCsB,EAAQV,OAAM,2BACjCW,EAGjCC,GAAgBnB,OAIpB,KAEI,YADAoB,aAAaC,GAAWJ,GAE1B,MAAOd,GACL,GAAImB,EAAanB,GAAM,CACnB,GAAIH,EAAKO,OAAS,EACd,KAAM,IAAIZ,OAAM,gCAAgCsB,EAAQV,OAAM,+BAIlEY,GAAgBnB,EAChB,UAGJ,KAAMG,KAKlB,QAASgB,GAAgBI,GACrBA,EAAIP,OAAO,EAAGQ,KAAKC,KAAKF,EAAIhB,OAAS,IAGzC,QAASe,GAAanB,GAClB,MAAOA,KACW,KAAbA,EAAIuB,MACS,OAAbvB,EAAIuB,MAA8B,+BAAbvB,EAAIwB,MAKlC,QAASzB,KACL,GAAMe,GAAUG,aAAaC,EAC7B,KAAKJ,EACD,QAGJ,IAAMjB,GAAOa,KAAKe,MAAMX,EACxB,KAAKY,MAAMC,QAAQ9B,GACf,KAAM,IAAIL,OAAM,+BAGpB,OAAOK,GAKX,QAAS+B,KACLX,aAAaY,WAAWX,GAG5B,QAASY,GAAYlC,EAAKmC,GACtB,MAAOC,GAAU,WACb/B,EAAQX,WACR2C,EAAQC,KAAKtC,IACdmC,EAAUI,YAGjB,QAASC,GAAYL,GACjB,MAAOC,GAAU,WAEb,MADA/B,GAAQX,WACD2C,EAAQI,QAChBN,GAGP,QAASO,GAAaP,GAClB,MAAOC,GAAU,WACb/B,EAAQX,WACR2C,EAAQM,SACTR,GAOP,QAASC,GAAUQ,EAAQT,GCmCvB,GDnCiCU,GAAO3C,SAAA4C,UAAA,GAAGC,EAAGD,UAAA,EAC9C,OAAKzC,GAAQ2C,QAQN,GAAIC,SAAQ,SAACC,EAASC,GACzBN,EAAQ,WACJO,EAAKR,EAAQ,SAACxC,EAAKiD,GACXjD,EACA+C,EAAO/C,GAEP8C,EAAQG,GAGRlB,GACAA,EAAS/B,EAAKiD,aAjB1BR,GAAQ,WACJO,EAAKR,EAAQT,KAuBzB,QAASiB,GAAKE,EAAInB,GACd,GAAI/B,GAAM,KACNiD,EAAMnD,MACV,KACImD,EAASC,IACX,MAAOC,GACLnD,EAAMmD,EAGNpB,GACAA,EAAS/B,EAAKiD,GAxNtB,GAAIhD,GAAOmD,OAAAC,qBACH/D,UCAAgE,IDAS,WAAK,MAAOhE,ICGrBiE,cAAc,EACdC,YAAY,GDHZZ,SCMAU,IDNQ,WAAK,MAAOV,ICSpBW,cAAc,EACdC,YAAY,GDTZtD,SCYAoD,IDZQ,WAAK,MAAOG,ICepBF,cAAc,EACdC,YAAY,KDXdjE,EAAuB,WACzB,GAAMmE,GAAM,0CACNC,EAAQtC,KAAKuC,SAAW,EAE9B,KACI3C,aAAayC,GAAOC,CACpB,IAAME,GAAU5C,aAAayC,KAASC,CAEtC,OADA1C,cAAaY,WAAW6B,GACjBG,EACT,MAAOV,GACL,OAAO,MAIT1D,EAA+B,gBAATiB,MAEtBhB,EAAkB,WAAagC,OAkB/BkB,EAA6B,kBAAZC,SAIjBY,EAAqC,gBAAZvD,SAE3B+B,EAAOmB,OAAAC,qBACHnB,MCkBAoB,IDlBK,WAAK,MAAO3D,ICqBjB4D,cAAc,EACdC,YAAY,GDrBZnB,MCwBAiB,IDxBK,WAAK,MAAOvD,IC2BjBwD,cAAc,EACdC,YAAY,GD3BZjB,OC8BAe,ID9BM,WAAK,MAAO1B,ICiClB2B,cAAc,EACdC,YAAY,KD/BdtC,EAAU,uCAEV4C,EAAW,IACX/C,EAAuB,EAAX+C,EAAe,GAC3BlD,EAAU,IAwHV+B,EAAM,SAAAO,GCiCR,MDjCcA,KA0ClBlE,GAAQkD,KAAOJ,EACf9C,EAAQqD,KAAOD,EACfpD,EAAQuD,MAAQD","file":"playbyplay.min.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    factory((global.playbyplay = {}))\n}(this, function (exports) { 'use strict';\n\n    var support = {\n        get required () { return required; },\n        get promise () { return promise; },\n        get console () { return supportsConsole; }\n    };\n\n    // Required features\n\n    const supportsLocalStorage = (() => {\n        const key = 'playbyplay_support_Vo8yTd6aLS$A8huo9$e7';\n        const value = Math.random() + '';\n\n        try {\n            localStorage[key] = value;\n            const success = localStorage[key] === value;\n            localStorage.removeItem(key);\n            return success;\n        } catch (e) {\n            return false;\n        }\n    })();\n\n    const supportsJSON = typeof JSON === 'object';\n\n    const supportsIsArray = 'isArray' in Array;\n\n    function required() {\n        if (!supportsLocalStorage) {\n            throw new Error('localStorage is not supported');\n        }\n\n        if (!supportsJSON) {\n            throw new Error('JSON is not supported');\n        }\n\n        if (!supportsIsArray) {\n            throw new Error('Array.isArray is not supported');\n        }\n    }\n\n    // Optional features\n\n    const promise = typeof Promise === 'function';\n\n    // Cannot directly write `export const console = ...` because it would redefine `console` in the\n    // current scope.\n    const supportsConsole = typeof console === 'object';\n\n    var storage = {\n        get save () { return storage__save; },\n        get load () { return storage__load; },\n        get clear () { return storage__clear; }\n    };\n\n    const runsKey = 'playbyplay_runs_A*O%y21#Q1WSh^f09YO!';\n\n    const maxBytes = 50000; // Max history size in bytes.\n    const maxLength = maxBytes * 8 / 16; // Max history string length. Assumes 16 bits per code point.\n    const maxRuns = 200; // Max runs in history.\n\n    // Save\n\n    function storage__save(run) {\n        let runs;\n        try {\n            runs = storage__load();\n        } catch (err) {\n            if (support.console) {\n                console.error('playbyplay: could not load previous runs, resetting history', err);\n            }\n\n            runs = [];\n        }\n\n        if (runs.length && sameRun(run, runs[runs.length - 1])) {\n            return;\n        }\n\n        runs.push(run);\n        saveRuns(runs);\n    }\n\n    function sameRun(a, b) {\n        return JSON.stringify(a) === JSON.stringify(b);\n    }\n\n    function saveRuns(runs) {\n        if (runs.length > maxRuns) {\n            runs.splice(0, runs.length - maxRuns);\n        }\n\n        while (true) { // eslint-disable-line no-constant-condition\n            let runsStr = JSON.stringify(runs);\n\n            if (runsStr.length > maxLength) {\n                if (runs.length < 2) {\n                    throw new Error(`Could not save run of length ${runsStr.length}, ` +\n                        `the maximum length is ${maxLength}`);\n                }\n\n                removeFirstHalf(runs);\n                continue;\n            }\n\n            try {\n                localStorage[runsKey] = runsStr;\n                return;\n            } catch (err) {\n                if (isQuotaError(err)) {\n                    if (runs.length < 2) {\n                        throw new Error(`Could not save run of length ${runsStr.length}, ` +\n                            `exceeds localStorage quota`);\n                    }\n\n                    removeFirstHalf(runs);\n                    continue;\n                }\n\n                throw err;\n            }\n        }\n    }\n\n    function removeFirstHalf(arr) {\n        arr.splice(0, Math.ceil(arr.length / 2));\n    }\n\n    function isQuotaError(err) {\n        return err &&\n            (err.code === 22 ||\n             err.code === 1014 && err.name === 'NS_ERROR_DOM_QUOTA_REACHED');\n    }\n\n    // Load\n\n    function storage__load() {\n        const runsStr = localStorage[runsKey];\n        if (!runsStr) {\n            return [];\n        }\n\n        const runs = JSON.parse(runsStr);\n        if (!Array.isArray(runs)) {\n            throw new Error('Loaded runs are not an Array');\n        }\n\n        return runs;\n    }\n\n    // Clear\n\n    function storage__clear() {\n        localStorage.removeItem(runsKey);\n    }\n\n    function index__save(run, callback) {\n        return promisify(() => {\n            support.required();\n            storage.save(run);\n        }, callback, setTimeout);\n    }\n\n    function index__load(callback) {\n        return promisify(() => {\n            support.required();\n            return storage.load();\n        }, callback);\n    }\n\n    function index__clear(callback) {\n        return promisify(() => {\n            support.required();\n            storage.clear();\n        }, callback);\n    }\n\n    // Optional promises\n\n    const now = fn => fn();\n\n    function promisify(syncFn, callback, asyncFn = now) {\n        if (!support.promise) {\n            asyncFn(() => {\n                exec(syncFn, callback);\n            });\n\n            return;\n        }\n\n        return new Promise((resolve, reject) => { // eslint-disable-line consistent-return\n            asyncFn(() => {\n                exec(syncFn, (err, result) => {\n                    if (err) {\n                        reject(err);\n                    } else {\n                        resolve(result);\n                    }\n\n                    if (callback) {\n                        callback(err, result);\n                    }\n                });\n            });\n        });\n    }\n\n    function exec(fn, callback) {\n        let err = null;\n        let result;\n        try {\n            result = fn();\n        } catch (e) {\n            err = e;\n        }\n\n        if (callback) {\n            callback(err, result);\n        }\n    }\n\n    exports.save = index__save;\n    exports.load = index__load;\n    exports.clear = index__clear;\n\n}));\n","!function(e,r){\"object\"==typeof exports&&\"undefined\"!=typeof module?r(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],r):r(e.playbyplay={})}(this,function(e){\"use strict\";function r(){if(!p)throw new Error(\"localStorage is not supported\");if(!h)throw new Error(\"JSON is not supported\");if(!m)throw new Error(\"Array.isArray is not supported\")}function n(e){var r=void 0;try{r=a()}catch(n){y.console&&console.error(\"playbyplay: could not load previous runs, resetting history\",n),r=[]}r.length&&t(e,r[r.length-1])||(r.push(e),o(r))}function t(e,r){return JSON.stringify(e)===JSON.stringify(r)}function o(e){for(e.length>E&&e.splice(0,e.length-E);;){var r=JSON.stringify(e);if(r.length>A){if(e.length<2)throw new Error(\"Could not save run of length \"+r.length+\", the maximum length is \"+A);i(e)}else try{return void(localStorage[w]=r)}catch(n){if(u(n)){if(e.length<2)throw new Error(\"Could not save run of length \"+r.length+\", exceeds localStorage quota\");i(e);continue}throw n}}}function i(e){e.splice(0,Math.ceil(e.length/2))}function u(e){return e&&(22===e.code||1014===e.code&&\"NS_ERROR_DOM_QUOTA_REACHED\"===e.name)}function a(){var e=localStorage[w];if(!e)return[];var r=JSON.parse(e);if(!Array.isArray(r))throw new Error(\"Loaded runs are not an Array\");return r}function c(){localStorage.removeItem(w)}function l(e,r){return g(function(){y.required(),S.save(e)},r,setTimeout)}function f(e){return g(function(){return y.required(),S.load()},e)}function s(e){return g(function(){y.required(),S.clear()},e)}function g(e,r){var n=void 0===arguments[2]?_:arguments[2];return y.promise?new Promise(function(t,o){n(function(){d(e,function(e,n){e?o(e):t(n),r&&r(e,n)})})}):void n(function(){d(e,r)})}function d(e,r){var n=null,t=void 0;try{t=e()}catch(o){n=o}r&&r(n,t)}var y=Object.defineProperties({},{required:{get:function(){return r},configurable:!0,enumerable:!0},promise:{get:function(){return v},configurable:!0,enumerable:!0},console:{get:function(){return b},configurable:!0,enumerable:!0}}),p=function(){var e=\"playbyplay_support_Vo8yTd6aLS$A8huo9$e7\",r=Math.random()+\"\";try{localStorage[e]=r;var n=localStorage[e]===r;return localStorage.removeItem(e),n}catch(t){return!1}}(),h=\"object\"==typeof JSON,m=\"isArray\"in Array,v=\"function\"==typeof Promise,b=\"object\"==typeof console,S=Object.defineProperties({},{save:{get:function(){return n},configurable:!0,enumerable:!0},load:{get:function(){return a},configurable:!0,enumerable:!0},clear:{get:function(){return c},configurable:!0,enumerable:!0}}),w=\"playbyplay_runs_A*O%y21#Q1WSh^f09YO!\",O=5e4,A=8*O/16,E=200,_=function(e){return e()};e.save=l,e.load=f,e.clear=s});\n//# sourceMappingURL=playbyplay.min.js.map"],"sourceRoot":"/source/"}