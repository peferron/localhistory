{"version":3,"sources":["playbyplay.js"],"names":[],"mappings":"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","file":"playbyplay.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    factory((global.playbyplay = {}))\n}(this, function (exports) { 'use strict';\n\n    var support = {\n        get required () { return required; },\n        get promise () { return promise; },\n        get console () { return supportsConsole; }\n    };\n\n    // Required features\n\n    const supportsLocalStorage = (() => {\n        const key = 'playbyplay_support_Vo8yTd6aLS$A8huo9$e7';\n        const value = Math.random() + '';\n\n        try {\n            localStorage[key] = value;\n            const success = localStorage[key] === value;\n            localStorage.removeItem(key);\n            return success;\n        } catch (e) {\n            return false;\n        }\n    })();\n\n    const supportsJSON = typeof JSON === 'object';\n\n    const supportsIsArray = 'isArray' in Array;\n\n    function required() {\n        if (!supportsLocalStorage) {\n            throw new Error('localStorage is not supported');\n        }\n\n        if (!supportsJSON) {\n            throw new Error('JSON is not supported');\n        }\n\n        if (!supportsIsArray) {\n            throw new Error('Array.isArray is not supported');\n        }\n    }\n\n    // Optional features\n\n    const promise = typeof Promise === 'function';\n\n    // Cannot directly write `export const console = ...` because it would redefine `console` in the\n    // current scope.\n    const supportsConsole = typeof console === 'object';\n\n    var storage = {\n        get save () { return storage__save; },\n        get load () { return storage__load; },\n        get clear () { return storage__clear; }\n    };\n\n    const runsKey = 'playbyplay_runs_A*O%y21#Q1WSh^f09YO!';\n\n    const maxBytes = 50000; // Max history size in bytes.\n    const maxLength = maxBytes * 8 / 16; // Max history string length. Assumes 16 bits per code point.\n    const maxRuns = 200; // Max runs in history.\n\n    // Save\n\n    function storage__save(run) {\n        let runs;\n        try {\n            runs = storage__load();\n        } catch (err) {\n            if (support.console) {\n                console.error('playbyplay: could not load previous runs, resetting history', err);\n            }\n\n            runs = [];\n        }\n\n        if (runs.length && sameRun(run, runs[runs.length - 1])) {\n            return;\n        }\n\n        runs.push(run);\n        saveRuns(runs);\n    }\n\n    function sameRun(a, b) {\n        return JSON.stringify(a) === JSON.stringify(b);\n    }\n\n    function saveRuns(runs) {\n        if (runs.length > maxRuns) {\n            runs.splice(0, runs.length - maxRuns);\n        }\n\n        while (true) { // eslint-disable-line no-constant-condition\n            let runsStr = JSON.stringify(runs);\n\n            if (runsStr.length > maxLength) {\n                if (runs.length < 2) {\n                    throw new Error(`Could not save run of length ${runsStr.length}, ` +\n                        `the maximum length is ${maxLength}`);\n                }\n\n                removeFirstHalf(runs);\n                continue;\n            }\n\n            try {\n                localStorage[runsKey] = runsStr;\n                return;\n            } catch (err) {\n                if (isQuotaError(err)) {\n                    if (runs.length < 2) {\n                        throw new Error(`Could not save run of length ${runsStr.length}, ` +\n                            `exceeds localStorage quota`);\n                    }\n\n                    removeFirstHalf(runs);\n                    continue;\n                }\n\n                throw err;\n            }\n        }\n    }\n\n    function removeFirstHalf(arr) {\n        arr.splice(0, Math.ceil(arr.length / 2));\n    }\n\n    function isQuotaError(err) {\n        return err &&\n            (err.code === 22 ||\n             err.code === 1014 && err.name === 'NS_ERROR_DOM_QUOTA_REACHED');\n    }\n\n    // Load\n\n    function storage__load() {\n        const runsStr = localStorage[runsKey];\n        if (!runsStr) {\n            return [];\n        }\n\n        const runs = JSON.parse(runsStr);\n        if (!Array.isArray(runs)) {\n            throw new Error('Loaded runs are not an Array');\n        }\n\n        return runs;\n    }\n\n    // Clear\n\n    function storage__clear() {\n        localStorage.removeItem(runsKey);\n    }\n\n    function index__save(run, callback) {\n        return promisify(() => {\n            support.required();\n            storage.save(run);\n        }, callback, setTimeout);\n    }\n\n    function index__load(callback) {\n        return promisify(() => {\n            support.required();\n            return storage.load();\n        }, callback);\n    }\n\n    function index__clear(callback) {\n        return promisify(() => {\n            support.required();\n            storage.clear();\n        }, callback);\n    }\n\n    // Optional promises\n\n    const now = fn => fn();\n\n    function promisify(syncFn, callback, asyncFn = now) {\n        if (!support.promise) {\n            asyncFn(() => {\n                exec(syncFn, callback);\n            });\n\n            return;\n        }\n\n        return new Promise((resolve, reject) => { // eslint-disable-line consistent-return\n            asyncFn(() => {\n                exec(syncFn, (err, result) => {\n                    if (err) {\n                        reject(err);\n                    } else {\n                        resolve(result);\n                    }\n\n                    if (callback) {\n                        callback(err, result);\n                    }\n                });\n            });\n        });\n    }\n\n    function exec(fn, callback) {\n        let err = null;\n        let result;\n        try {\n            result = fn();\n        } catch (e) {\n            err = e;\n        }\n\n        if (callback) {\n            callback(err, result);\n        }\n    }\n\n    exports.save = index__save;\n    exports.load = index__load;\n    exports.clear = index__clear;\n\n}));\n"],"sourceRoot":"./"}