{"version":3,"sources":["localhistory.js"],"names":[],"mappings":"AAAA,AAAC,CAAA,UAAU,MAAM,EAAE,OAAO,EAAE;AACxB,WAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,MAAM,KAAK,WAAW,GAAG,OAAO,CAAC,OAAO,CAAC,GAC/E,OAAO,MAAM,KAAK,UAAU,IAAI,MAAM,CAAC,GAAG,GAAG,MAAM,CAAC,CAAC,SAAS,CAAC,EAAE,OAAO,CAAC,GACzE,OAAO,CAAE,MAAM,CAAC,YAAY,GAAG,EAAE,CAAE,CAAA;CACtC,CAAA,CAAC,IAAI,EAAE,UAAU,OAAO,EAAE;;AAEvB,QAAI,OAAO,2BAAG,EAKb;AAJO,iBAAS;iBAAC,YAAG;AAAE,uBAAO,kBAAkB,CAAC;aAAE;;;;AAC3C,0BAAkB;iBAAC,YAAG;AAAE,uBAAO,kBAAkB,CAAC;aAAE;;;;AACpD,eAAO;iBAAC,YAAG;AAAE,uBAAO,OAAO,CAAC;aAAE;;;;AAC9B,mBAAW;iBAAC,YAAG;AAAE,uBAAO,WAAW,CAAC;aAAE;;;;MAC7C,CAAC;;;;AAIF,QAAM,oBAAoB,GAAG,CAAC,YAAM;AAChC,YAAM,GAAG,GAAG,2CAA2C,CAAC;AACxD,YAAM,KAAK,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC;;AAEjC,YAAI;AACA,wBAAY,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;AAC1B,gBAAM,OAAO,GAAG,YAAY,CAAC,GAAG,CAAC,KAAK,KAAK,CAAC;AAC5C,wBAAY,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;AAC7B,mBAAO,OAAO,CAAC;SAClB,CAAC,OAAO,CAAC,EAAE;AACR,mBAAO,KAAK,CAAC;SAChB;KACJ,CAAA,EAAG,CAAC;;AAEL,QAAM,kBAAkB,GAAG,oBAAoB,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,SAAS,IAAI,KAAK,CAAC;;AAElG,aAAS,kBAAkB,GAAG;AAC1B,YAAI,CAAC,kBAAkB,EAAE;AACrB,kBAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAC;SACjE;KACJ;;;;AAID,QAAM,OAAO,GAAG,OAAO,OAAO,KAAK,UAAU,CAAC;;AAE9C,aAAS,WAAW,GAAG;AACnB,YAAI;AACA,mBAAO,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;SAC1C,CAAC,OAAO,CAAC,EAAE,EACX;KACJ;;AAED,QAAI,OAAO,2BAAG,EAIb;AAHO,YAAI;iBAAC,YAAG;AAAE,uBAAO,aAAa,CAAC;aAAE;;;;AACjC,YAAI;iBAAC,YAAG;AAAE,uBAAO,aAAa,CAAC;aAAE;;;;AACjC,aAAK;iBAAC,YAAG;AAAE,uBAAO,cAAc,CAAC;aAAE;;;;MAC1C,CAAC;;AAEF,QAAM,OAAO,GAAG,wCAAwC,CAAC;;AAEzD,aAAS,aAAa,CAAC,GAAG,EAAE,OAAO,EAAE;AACjC,YAAI,OAAO,CAAC,OAAO,GAAG,CAAC,EAAE;AACrB,kBAAM,IAAI,KAAK,qCAAmC,OAAO,CAAC,OAAO,CAAG,CAAC;SACxE;;AAED,YAAI,IAAI,YAAA,CAAC;AACT,YAAI;AACA,gBAAI,GAAG,aAAa,EAAE,CAAC;SAC1B,CAAC,OAAO,GAAG,EAAE;AACV,mBAAO,CAAC,WAAW,CAAC,+DAA+D,EAAE,GAAG,CAAC,CAAC;AAC1F,gBAAI,GAAG,EAAE,CAAC;SACb;;AAED,YAAI,IAAI,CAAC,MAAM,IAAI,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,EAAE;AACpD,mBAAO;SACV;;AAED,YAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACf,gBAAQ,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;KAC3B;;AAED,aAAS,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE;AACnB,eAAO,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;KAClD;;AAED,aAAS,QAAQ,CAAC,IAAI,EAAE,OAAO,EAAE;AAC7B,YAAI,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,OAAO,EAAE;AAC/B,gBAAI,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC;SACjD;;AAED,eAAO,IAAI,EAAE;;AACT,gBAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;;AAErC,gBAAM,SAAS,GAAG,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;AACrC,gBAAI,SAAS,GAAG,OAAO,CAAC,QAAQ,EAAE;AAC9B,oBAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;AACjB,0BAAM,IAAI,KAAK,CAAC,kCAAgC,OAAO,CAAC,MAAM,gBACtD,SAAS,6BAAwB,OAAO,CAAC,QAAQ,CAAE,CAAC,CAAC;iBAChE;;AAED,+BAAe,CAAC,IAAI,CAAC,CAAC;AACtB,yBAAS;aACZ;;AAED,gBAAI;AACA,4BAAY,CAAC,OAAO,CAAC,GAAG,OAAO,CAAC;AAChC,uBAAO;aACV,CAAC,OAAO,GAAG,EAAE;AACV,oBAAI,YAAY,CAAC,GAAG,CAAC,EAAE;AACnB,wBAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;AACjB,8BAAM,IAAI,KAAK,CAAC,kCAAgC,OAAO,CAAC,MAAM,sCAC9B,CAAC,CAAC;qBACrC;;AAED,mCAAe,CAAC,IAAI,CAAC,CAAC;AACtB,6BAAS;iBACZ;;AAED,sBAAM,GAAG,CAAC;aACb;SACJ;KACJ;;AAED,aAAS,eAAe,CAAC,GAAG,EAAE;AAC1B,WAAG,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;KAC5C;;AAED,aAAS,YAAY,CAAC,GAAG,EAAE;AACvB,eAAO,GAAG,KACL,GAAG,CAAC,IAAI,KAAK,EAAE,IACf,GAAG,CAAC,IAAI,KAAK,IAAI,IAAI,GAAG,CAAC,IAAI,KAAK,4BAA4B,CAAA,AAAC,CAAC;KACxE;;AAED,aAAS,aAAa,GAAG;AACrB,YAAM,OAAO,GAAG,YAAY,CAAC,OAAO,CAAC,CAAC;AACtC,YAAI,CAAC,OAAO,EAAE;AACV,mBAAO,EAAE,CAAC;SACb;;AAED,YAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACjC,YAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;AACtB,kBAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;SACnD;;AAED,eAAO,IAAI,CAAC;KACf;;AAED,aAAS,cAAc,GAAG;AACtB,oBAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;KACpC;;AAED,aAAS,GAAG,CAAC,EAAE,EAAE;AACb,UAAE,EAAE,CAAC;KACR;;AAED,aAAS,SAAS,CAAC,MAAM,EAAE,QAAQ,EAAiB;YAAf,OAAO,gCAAG,GAAG;;AAC9C,YAAI,CAAC,OAAO,CAAC,OAAO,EAAE;AAClB,mBAAO,CAAC,YAAM;AACV,oBAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;aAC1B,CAAC,CAAC;;AAEH,mBAAO;SACV;;AAED,eAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;;AACpC,mBAAO,CAAC,YAAM;AACV,oBAAI,CAAC,MAAM,EAAE,UAAC,GAAG,EAAE,MAAM,EAAK;AAC1B,wBAAI,GAAG,EAAE;AACL,8BAAM,CAAC,GAAG,CAAC,CAAC;qBACf,MAAM;AACH,+BAAO,CAAC,MAAM,CAAC,CAAC;qBACnB;;AAED,wBAAI,QAAQ,EAAE;AACV,gCAAQ,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;qBACzB;iBACJ,CAAC,CAAC;aACN,CAAC,CAAC;SACN,CAAC,CAAC;KACN;;AAED,aAAS,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE;AACxB,YAAI,GAAG,GAAG,IAAI,CAAC;AACf,YAAI,MAAM,YAAA,CAAC;AACX,YAAI;AACA,kBAAM,GAAG,EAAE,EAAE,CAAC;SACjB,CAAC,OAAO,CAAC,EAAE;AACR,eAAG,GAAG,CAAC,CAAC;SACX;;AAED,YAAI,QAAQ,EAAE;AACV,oBAAQ,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;SACzB;KACJ;;AAED,QAAM,gBAAgB,GAAG,OAAO,CAAC,SAAS,CAAC;;AAE3C,aAAS,WAAW,CAAC,GAAG,EAAE,OAAO,EAAE,QAAQ,EAAE;AACzC,YAAM,EAAE,GAAG,OAAO,OAAO,KAAK,UAAU,GAAG,OAAO,GAAG,QAAQ,CAAC;AAC9D,YAAM,IAAI,GAAG,eAAe,CAAC,OAAO,OAAO,KAAK,QAAQ,GAAG,OAAO,GAAG,EAAE,CAAC,CAAC;;AAEzE,eAAO,SAAS,CAAC,YAAM;AACnB,mBAAO,CAAC,kBAAkB,EAAE,CAAC;AAC7B,mBAAO,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;SAC3B,EAAE,EAAE,EAAE,UAAU,CAAC,CAAC;KACtB;;AAED,aAAS,eAAe,CAAC,OAAO,EAAE;AAC9B,YAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;AACxB,mBAAO,CAAC,OAAO,GAAG,GAAG,CAAC;SACzB;AACD,YAAI,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;AACzB,mBAAO,CAAC,QAAQ,GAAG,MAAM,CAAC;SAC7B;AACD,eAAO,OAAO,CAAC;KAClB;;AAED,aAAS,WAAW,CAAC,QAAQ,EAAE;AAC3B,eAAO,SAAS,CAAC,YAAM;AACnB,mBAAO,CAAC,kBAAkB,EAAE,CAAC;AAC7B,mBAAO,OAAO,CAAC,IAAI,EAAE,CAAC;SACzB,EAAE,QAAQ,CAAC,CAAC;KAChB;;AAED,aAAS,YAAY,CAAC,QAAQ,EAAE;AAC5B,eAAO,SAAS,CAAC,YAAM;AACnB,mBAAO,CAAC,kBAAkB,EAAE,CAAC;AAC7B,mBAAO,CAAC,KAAK,EAAE,CAAC;SACnB,EAAE,QAAQ,CAAC,CAAC;KAChB;;AAED,WAAO,CAAC,SAAS,GAAG,gBAAgB,CAAC;AACrC,WAAO,CAAC,IAAI,GAAG,WAAW,CAAC;AAC3B,WAAO,CAAC,IAAI,GAAG,WAAW,CAAC;AAC3B,WAAO,CAAC,KAAK,GAAG,YAAY,CAAC;CAEhC,CAAC,CAAE","file":"localhistory.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    factory((global.localhistory = {}))\n}(this, function (exports) {\n\n    var support = {\n        get supported () { return support__supported; },\n        get throwIfUnsupported () { return throwIfUnsupported; },\n        get promise () { return promise; },\n        get consoleWarn () { return consoleWarn; }\n    };\n\n    // Required features.\n\n    const supportsLocalStorage = (() => {\n        const key = 'localhistory_support_Vo8yTd6aLS$A8huo9$e7';\n        const value = Math.random() + '';\n\n        try {\n            localStorage[key] = value;\n            const success = localStorage[key] === value;\n            localStorage.removeItem(key);\n            return success;\n        } catch (e) {\n            return false;\n        }\n    })();\n\n    const support__supported = supportsLocalStorage && typeof JSON === 'object' && 'isArray' in Array;\n\n    function throwIfUnsupported() {\n        if (!support__supported) {\n            throw new Error('This browser does not support localhistory');\n        }\n    }\n\n    // Optional features.\n\n    const promise = typeof Promise === 'function';\n\n    function consoleWarn() {\n        try {\n            console.warn.apply(console, arguments); // eslint-disable-line no-console\n        } catch (e) { // eslint-disable-line no-empty\n        }\n    }\n\n    var storage = {\n        get save () { return storage__save; },\n        get load () { return storage__load; },\n        get clear () { return storage__clear; }\n    };\n\n    const runsKey = 'localhistory_runs_A*O%y21#Q1WSh^f09YO!';\n\n    function storage__save(run, options) {\n        if (options.maxRuns < 1) {\n            throw new Error(`Could not save run, maxRuns is ${options.maxRuns}`);\n        }\n\n        let runs;\n        try {\n            runs = storage__load();\n        } catch (err) {\n            support.consoleWarn('localhistory: could not load previous runs, resetting history', err);\n            runs = [];\n        }\n\n        if (runs.length && sameRun(run, runs[runs.length - 1])) {\n            return;\n        }\n\n        runs.push(run);\n        saveRuns(runs, options);\n    }\n\n    function sameRun(a, b) {\n        return JSON.stringify(a) === JSON.stringify(b);\n    }\n\n    function saveRuns(runs, options) {\n        if (runs.length > options.maxRuns) {\n            runs.splice(0, runs.length - options.maxRuns);\n        }\n\n        while (true) { // eslint-disable-line no-constant-condition\n            const runsStr = JSON.stringify(runs);\n\n            const runsBytes = runsStr.length * 2; // Assumes 16 bits (2 bytes) per code point.\n            if (runsBytes > options.maxBytes) {\n                if (runs.length < 2) {\n                    throw new Error(`Could not save run of length ${runsStr.length} ` +\n                        `(${runsBytes} bytes), maxBytes is ${options.maxBytes}`);\n                }\n\n                removeFirstHalf(runs);\n                continue;\n            }\n\n            try {\n                localStorage[runsKey] = runsStr;\n                return;\n            } catch (err) {\n                if (isQuotaError(err)) {\n                    if (runs.length < 2) {\n                        throw new Error(`Could not save run of length ${runsStr.length}, ` +\n                            `exceeds localStorage quota`);\n                    }\n\n                    removeFirstHalf(runs);\n                    continue;\n                }\n\n                throw err;\n            }\n        }\n    }\n\n    function removeFirstHalf(arr) {\n        arr.splice(0, Math.ceil(arr.length / 2));\n    }\n\n    function isQuotaError(err) {\n        return err &&\n            (err.code === 22 ||\n             err.code === 1014 && err.name === 'NS_ERROR_DOM_QUOTA_REACHED');\n    }\n\n    function storage__load() {\n        const runsStr = localStorage[runsKey];\n        if (!runsStr) {\n            return [];\n        }\n\n        const runs = JSON.parse(runsStr);\n        if (!Array.isArray(runs)) {\n            throw new Error('Loaded runs are not an Array');\n        }\n\n        return runs;\n    }\n\n    function storage__clear() {\n        localStorage.removeItem(runsKey);\n    }\n\n    function now(fn) {\n        fn();\n    }\n\n    function promisify(syncFn, callback, asyncFn = now) {\n        if (!support.promise) {\n            asyncFn(() => {\n                exec(syncFn, callback);\n            });\n\n            return;\n        }\n\n        return new Promise((resolve, reject) => { // eslint-disable-line consistent-return\n            asyncFn(() => {\n                exec(syncFn, (err, result) => {\n                    if (err) {\n                        reject(err);\n                    } else {\n                        resolve(result);\n                    }\n\n                    if (callback) {\n                        callback(err, result);\n                    }\n                });\n            });\n        });\n    }\n\n    function exec(fn, callback) {\n        let err = null;\n        let result;\n        try {\n            result = fn();\n        } catch (e) {\n            err = e;\n        }\n\n        if (callback) {\n            callback(err, result);\n        }\n    }\n\n    const index__supported = support.supported;\n\n    function index__save(run, options, callback) {\n        const cb = typeof options === 'function' ? options : callback;\n        const opts = fillSaveOptions(typeof options === 'object' ? options : {});\n\n        return promisify(() => {\n            support.throwIfUnsupported();\n            storage.save(run, opts);\n        }, cb, setTimeout);\n    }\n\n    function fillSaveOptions(options) {\n        if (isNaN(options.maxRuns)) {\n            options.maxRuns = 100;\n        }\n        if (isNaN(options.maxBytes)) {\n            options.maxBytes = 100000;\n        }\n        return options;\n    }\n\n    function index__load(callback) {\n        return promisify(() => {\n            support.throwIfUnsupported();\n            return storage.load();\n        }, callback);\n    }\n\n    function index__clear(callback) {\n        return promisify(() => {\n            support.throwIfUnsupported();\n            storage.clear();\n        }, callback);\n    }\n\n    exports.supported = index__supported;\n    exports.save = index__save;\n    exports.load = index__load;\n    exports.clear = index__clear;\n\n}));\n"],"sourceRoot":"./"}